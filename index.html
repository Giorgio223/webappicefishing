<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IceFishing Wheel</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg1:#e9f4ff; --bg2:#cfe6ff; --ink:#0b1220;
      --ring:#152033; --ring2:#0d1424;
      --a:#66c7ff; --b:#4fb7ff;
      --accent:#5eead4;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:
        radial-gradient(900px 600px at 30% 15%, rgba(255,255,255,.95), rgba(255,255,255,0) 60%),
        radial-gradient(1200px 900px at 70% 30%, rgba(255,255,255,.65), rgba(255,255,255,0) 65%),
        radial-gradient(1400px 900px at 50% 60%, var(--bg1), var(--bg2));
      padding:16px;
    }
    .wrap{width:min(520px, 96vw);}
    .hud{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      margin-bottom:10px;
    }
    .title{
      font-weight:900; letter-spacing:.4px; color:#0b1220;
      display:flex; gap:8px; align-items:center;
    }
    .btns{display:flex; gap:10px;}
    button{
      border:1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.7);
      color:#0b1220;
      padding:10px 14px;
      border-radius:14px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 8px 20px rgba(0,0,0,.12);
    }
    button.primary{
      background: linear-gradient(135deg, rgba(94,234,212,.35), rgba(255,255,255,.75));
      border-color: rgba(0,0,0,.10);
    }
    button:disabled{opacity:.6; cursor:not-allowed}

    .stage{
      position:relative;
      width:min(430px, 96vw);
      height:min(430px, 96vw);
      margin:0 auto;
      border-radius:50%;
      display:flex; justify-content:center; align-items:center;
      filter: drop-shadow(0 24px 40px rgba(0,0,0,.25));
    }
    canvas{
      width:100%;
      height:100%;
      border-radius:50%;
    }
    /* ‚Äú—Å—Ç—Ä–µ–ª–∫–∞‚Äù –∫–∞–∫ –º–∞–ª–µ–Ω—å–∫–∏–π —è–∑—ã—á–æ–∫ —Å–≤–µ—Ä—Ö—É */
    .pointer{
      position:absolute;
      top:-6px;
      width:0;height:0;
      border-left:16px solid transparent;
      border-right:16px solid transparent;
      border-top:30px solid #111827;
      filter: drop-shadow(0 10px 10px rgba(0,0,0,.25));
    }
    .pointer::after{
      content:"";
      position:absolute;
      left:-10px; top:-28px;
      width:0;height:0;
      border-left:10px solid transparent;
      border-right:10px solid transparent;
      border-top:18px solid rgba(255,255,255,.9);
      opacity:.85;
    }

    .result{
      margin-top:12px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(0,0,0,.08);
      border-radius:16px;
      padding:12px 14px;
      display:flex; justify-content:space-between; align-items:center;
      box-shadow: 0 10px 25px rgba(0,0,0,.10);
      color:#0b1220;
      gap:12px;
    }
    .pill{
      padding:6px 10px;
      border-radius:999px;
      font-weight:900;
      font-size:12px;
      background: rgba(11,18,32,.9);
      color: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.15);
      white-space:nowrap;
    }
    .small{font-size:12px; opacity:.75; font-weight:700;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hud">
      <div class="title">üßä ICE FISHING</div>
      <div class="btns">
        <button id="resetBtn">‚Ü∫ Reset</button>
        <button id="spinBtn" class="primary">‚ñ∂ Spin</button>
      </div>
    </div>

    <div class="stage">
      <div class="pointer"></div>
      <canvas id="wheel" width="900" height="900"></canvas>
    </div>

    <div class="result">
      <div>
        <div style="font-weight:900">–†–µ–∑—É–ª—å—Ç–∞—Ç: <span id="winText">‚Äî</span></div>
        <div class="small">–°–µ–∫—Ç–æ—Ä: <span id="winIdx">‚Äî</span></div>
      </div>
      <div class="pill" id="status">READY</div>
    </div>
  </div>

<script>
  // Telegram WebApp (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –Ω–æ –Ω–æ—Ä–º)
  const tg = window.Telegram?.WebApp;
  if (tg) { tg.ready(); tg.expand(); }

  // ====== –î–ê–ù–ù–´–ï –ö–û–õ–ï–°–ê: 53 –Ø–ß–ï–ô–ö–ò ======
  const N = 53;

  // ‚Äú–°–ø–µ—Ü-—Å–µ–∫—Ç–æ—Ä–∞‚Äù —Å –±–∞–Ω–Ω–µ—Ä–∞–º–∏ (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ: –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–æ–ª—å—à–∏—Ö —Ü–≤–µ—Ç–Ω—ã—Ö)
  // –ú–æ–∂–Ω–æ –ø–æ—Ç–æ–º –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä—ã–±—ã.
  const specials = [
    { label: "HUGE REDS",    color: "#d64545", text: "#ffffff", count: 1 },
    { label: "BIG ORANGES",  color: "#f59e0b", text: "#1b1b1b", count: 2 },
    { label: "LIL' BLUES",   color: "#2563eb", text: "#ffffff", count: 3 },
  ];

  // –ó–∞–ø–æ–ª–Ω–∏–º 53 —Å–µ–∫—Ç–æ—Ä–∞: –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ ‚Äî –æ–±—ã—á–Ω—ã–µ –ª–µ–¥—è–Ω—ã–µ,
  // —á–∞—Å—Ç—å ‚Äî —Å–ø–µ—Ü —Å –±–∞–Ω–Ω–µ—Ä–æ–º, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏–º –ø–æ –∫—Ä—É–≥—É —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ.
  const sectors = Array.from({length:N}, (_,i)=>({ kind:"base", label:"" }));

  function placeEvenly(kindObj, howMany){
    // —Ä–∞—Å–∫–∏–¥—ã–≤–∞–µ–º –ø–æ –∫—Ä—É–≥—É –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ
    for (let k=0;k<howMany;k++){
      const pos = Math.floor((k+1) * (N/(howMany+1)));
      // –µ—Å–ª–∏ –∑–∞–Ω—è—Ç–æ ‚Äî —Å–¥–≤–∏–≥–∞–µ–º
      let p = pos;
      while (sectors[p]?.kind !== "base") p = (p+1)%N;
      sectors[p] = { kind:"special", ...kindObj };
    }
  }

  for (const s of specials) placeEvenly({label:s.label, color:s.color, text:s.text}, s.count);

  // –ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –±–∞–∑–æ–≤—ã–µ —Å–µ–∫—Ç–æ—Ä–∞ —Ç–æ–∂–µ –±—ã–ª–∏ ‚Äú—Ä—ã–±—ã‚Äù, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–ª–Ω–∏ –º–∞—Å—Å–∏–≤:
  // –Ω–∞–ø—Ä–∏–º–µ—Ä: const baseFish = ["–û–∫—É–Ω—å","–©—É–∫–∞",...]; –∏ –Ω–∏–∂–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–π.
  // –°–µ–π—á–∞—Å –±–∞–∑–æ–≤—ã–µ ‚Äî –±–µ–∑ —Ç–µ–∫—Å—Ç–∞ (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ: —É–∑–∫–∏–µ –≥–æ–ª—É–±—ã–µ —Å–µ–∫—Ç–æ—Ä–∞ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º).
  // –ü–æ–±–µ–¥—É –º—ã –±—É–¥–µ–º –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å: —Å–ø–µ—Ü-–ª–µ–π–±–ª –∏–ª–∏ ‚Äú–û–±—ã—á–Ω–∞—è —Ä—ã–±–∞‚Äù.
  function winName(sec){
    if (sec.kind === "special") return sec.label;
    return "–û–±—ã—á–Ω–∞—è —Ä—ã–±–∞";
  }

  // ====== –†–ï–ù–î–ï–† –ö–û–õ–ï–°–ê (Canvas) ======
  const canvas = document.getElementById("wheel");
  const ctx = canvas.getContext("2d");
  const W = canvas.width, H = canvas.height;
  const cx = W/2, cy = H/2;

  const outerR = Math.min(W,H)*0.47;
  const rimR   = outerR*1.00;
  const innerR = outerR*0.22;

  const step = (Math.PI*2)/N;

  const spinBtn = document.getElementById("spinBtn");
  const resetBtn = document.getElementById("resetBtn");
  const winText = document.getElementById("winText");
  const winIdx = document.getElementById("winIdx");
  const status = document.getElementById("status");

  let angle = 0;
  let spinning = false;

  function normalize(a){
    const t = Math.PI*2;
    return ((a%t)+t)%t;
  }

  // Pointer —Å–≤–µ—Ä—Ö—É (12 —á–∞—Å–æ–≤) => -PI/2
  function indexAtPointer(a){
    const pointerWorld = -Math.PI/2;
    const rel = normalize(pointerWorld - a);
    return Math.floor(rel / step);
  }

  // ‚Äú—Å–µ—Ä–¥–µ—á–∫–æ/–∫–∞–ø–ª—è‚Äù –ø–∞—Ç—Ç–µ—Ä–Ω –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ ‚Äî —Ä–∏—Å—É–µ–º –º–∞–ª–µ–Ω—å–∫–∏–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏
  function drawPatternInSlice(a0, a1){
    // –¥–µ–ª–∞–µ–º 2-3 —Ä—è–¥–∞ —Å–∏–º–≤–æ–ª–æ–≤ –≤–¥–æ–ª—å —Ä–∞–¥
