<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IceFishing Wheel</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg1:#e9f4ff; --bg2:#cfe6ff; --ink:#0b1220;
      --ring:#152033; --ring2:#0d1424;
      --a:#66c7ff; --b:#4fb7ff;
      --accent:#5eead4;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:
        radial-gradient(900px 600px at 30% 15%, rgba(255,255,255,.95), rgba(255,255,255,0) 60%),
        radial-gradient(1200px 900px at 70% 30%, rgba(255,255,255,.65), rgba(255,255,255,0) 65%),
        radial-gradient(1400px 900px at 50% 60%, var(--bg1), var(--bg2));
      padding:16px;
    }
    .wrap{width:min(520px, 96vw);}
    .hud{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      margin-bottom:10px;
    }
    .title{
      font-weight:900; letter-spacing:.4px; color:#0b1220;
      display:flex; gap:8px; align-items:center;
    }
    .btns{display:flex; gap:10px;}
    button{
      border:1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.7);
      color:#0b1220;
      padding:10px 14px;
      border-radius:14px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 8px 20px rgba(0,0,0,.12);
    }
    button.primary{
      background: linear-gradient(135deg, rgba(94,234,212,.35), rgba(255,255,255,.75));
      border-color: rgba(0,0,0,.10);
    }
    button:disabled{opacity:.6; cursor:not-allowed}

    .stage{
      position:relative;
      width:min(430px, 96vw);
      height:min(430px, 96vw);
      margin:0 auto;
      border-radius:50%;
      display:flex; justify-content:center; align-items:center;
      filter: drop-shadow(0 24px 40px rgba(0,0,0,.25));
    }
    canvas{
      width:100%;
      height:100%;
      border-radius:50%;
    }
    /* ‚Äú—Å—Ç—Ä–µ–ª–∫–∞‚Äù –∫–∞–∫ –º–∞–ª–µ–Ω—å–∫–∏–π —è–∑—ã—á–æ–∫ —Å–≤–µ—Ä—Ö—É */
    .pointer{
      position:absolute;
      top:-6px;
      width:0;height:0;
      border-left:16px solid transparent;
      border-right:16px solid transparent;
      border-top:30px solid #111827;
      filter: drop-shadow(0 10px 10px rgba(0,0,0,.25));
    }
    .pointer::after{
      content:"";
      position:absolute;
      left:-10px; top:-28px;
      width:0;height:0;
      border-left:10px solid transparent;
      border-right:10px solid transparent;
      border-top:18px solid rgba(255,255,255,.9);
      opacity:.85;
    }

    .result{
      margin-top:12px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(0,0,0,.08);
      border-radius:16px;
      padding:12px 14px;
      display:flex; justify-content:space-between; align-items:center;
      box-shadow: 0 10px 25px rgba(0,0,0,.10);
      color:#0b1220;
      gap:12px;
    }
    .pill{
      padding:6px 10px;
      border-radius:999px;
      font-weight:900;
      font-size:12px;
      background: rgba(11,18,32,.9);
      color: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.15);
      white-space:nowrap;
    }
    .small{font-size:12px; opacity:.75; font-weight:700;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hud">
      <div class="title">üßä ICE FISHING</div>
      <div class="btns">
        <button id="resetBtn">‚Ü∫ Reset</button>
        <button id="spinBtn" class="primary">‚ñ∂ Spin</button>
      </div>
    </div>

    <div class="stage">
      <div class="pointer"></div>
      <canvas id="wheel" width="900" height="900"></canvas>
    </div>

    <div class="result">
      <div>
        <div style="font-weight:900">–†–µ–∑—É–ª—å—Ç–∞—Ç: <span id="winText">‚Äî</span></div>
        <div class="small">–°–µ–∫—Ç–æ—Ä: <span id="winIdx">‚Äî</span></div>
      </div>
      <div class="pill" id="status">READY</div>
    </div>
  </div>

<script>
  // Telegram WebApp (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –Ω–æ –Ω–æ—Ä–º)
  const tg = window.Telegram?.WebApp;
  if (tg) { tg.ready(); tg.expand(); }

  // ====== –î–ê–ù–ù–´–ï –ö–û–õ–ï–°–ê: 53 –Ø–ß–ï–ô–ö–ò ======
  const N = 53;

  // ‚Äú–°–ø–µ—Ü-—Å–µ–∫—Ç–æ—Ä–∞‚Äù —Å –±–∞–Ω–Ω–µ—Ä–∞–º–∏ (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ: –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–æ–ª—å—à–∏—Ö —Ü–≤–µ—Ç–Ω—ã—Ö)
  // –ú–æ–∂–Ω–æ –ø–æ—Ç–æ–º –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä—ã–±—ã.
  const specials = [
    { label: "HUGE REDS",    color: "#d64545", text: "#ffffff", count: 1 },
    { label: "BIG ORANGES",  color: "#f59e0b", text: "#1b1b1b", count: 2 },
    { label: "LIL' BLUES",   color: "#2563eb", text: "#ffffff", count: 3 },
  ];

  // –ó–∞–ø–æ–ª–Ω–∏–º 53 —Å–µ–∫—Ç–æ—Ä–∞: –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ ‚Äî –æ–±—ã—á–Ω—ã–µ –ª–µ–¥—è–Ω—ã–µ,
  // —á–∞—Å—Ç—å ‚Äî —Å–ø–µ—Ü —Å –±–∞–Ω–Ω–µ—Ä–æ–º, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏–º –ø–æ –∫—Ä—É–≥—É —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ.
  const sectors = Array.from({length:N}, (_,i)=>({ kind:"base", label:"" }));

  function placeEvenly(kindObj, howMany){
    // —Ä–∞—Å–∫–∏–¥—ã–≤–∞–µ–º –ø–æ –∫—Ä—É–≥—É –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ
    for (let k=0;k<howMany;k++){
      const pos = Math.floor((k+1) * (N/(howMany+1)));
      // –µ—Å–ª–∏ –∑–∞–Ω—è—Ç–æ ‚Äî —Å–¥–≤–∏–≥–∞–µ–º
      let p = pos;
      while (sectors[p]?.kind !== "base") p = (p+1)%N;
      sectors[p] = { kind:"special", ...kindObj };
    }
  }

  for (const s of specials) placeEvenly({label:s.label, color:s.color, text:s.text}, s.count);

  // –ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –±–∞–∑–æ–≤—ã–µ —Å–µ–∫—Ç–æ—Ä–∞ —Ç–æ–∂–µ –±—ã–ª–∏ ‚Äú—Ä—ã–±—ã‚Äù, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–ª–Ω–∏ –º–∞—Å—Å–∏–≤:
  // –Ω–∞–ø—Ä–∏–º–µ—Ä: const baseFish = ["–û–∫—É–Ω—å","–©—É–∫–∞",...]; –∏ –Ω–∏–∂–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–π.
  // –°–µ–π—á–∞—Å –±–∞–∑–æ–≤—ã–µ ‚Äî –±–µ–∑ —Ç–µ–∫—Å—Ç–∞ (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ: —É–∑–∫–∏–µ –≥–æ–ª—É–±—ã–µ —Å–µ–∫—Ç–æ—Ä–∞ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º).
  // –ü–æ–±–µ–¥—É –º—ã –±—É–¥–µ–º –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å: —Å–ø–µ—Ü-–ª–µ–π–±–ª –∏–ª–∏ ‚Äú–û–±—ã—á–Ω–∞—è —Ä—ã–±–∞‚Äù.
  function winName(sec){
    if (sec.kind === "special") return sec.label;
    return "–û–±—ã—á–Ω–∞—è —Ä—ã–±–∞";
  }

  // ====== –†–ï–ù–î–ï–† –ö–û–õ–ï–°–ê (Canvas) ======
  const canvas = document.getElementById("wheel");
  const ctx = canvas.getContext("2d");
  const W = canvas.width, H = canvas.height;
  const cx = W/2, cy = H/2;

  const outerR = Math.min(W,H)*0.47;
  const rimR   = outerR*1.00;
  const innerR = outerR*0.22;

  const step = (Math.PI*2)/N;

  const spinBtn = document.getElementById("spinBtn");
  const resetBtn = document.getElementById("resetBtn");
  const winText = document.getElementById("winText");
  const winIdx = document.getElementById("winIdx");
  const status = document.getElementById("status");

  let angle = 0;
  let spinning = false;

  function normalize(a){
    const t = Math.PI*2;
    return ((a%t)+t)%t;
  }

  // Pointer —Å–≤–µ—Ä—Ö—É (12 —á–∞—Å–æ–≤) => -PI/2
  function indexAtPointer(a){
    const pointerWorld = -Math.PI/2;
    const rel = normalize(pointerWorld - a);
    return Math.floor(rel / step);
  }

  // ‚Äú—Å–µ—Ä–¥–µ—á–∫–æ/–∫–∞–ø–ª—è‚Äù –ø–∞—Ç—Ç–µ—Ä–Ω –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ ‚Äî —Ä–∏—Å—É–µ–º –º–∞–ª–µ–Ω—å–∫–∏–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏
  function drawPatternInSlice(a0, a1){
    // –¥–µ–ª–∞–µ–º 2-3 —Ä—è–¥–∞ —Å–∏–º–≤–æ–ª–æ–≤ –≤–¥–æ–ª—å —Ä–∞–¥–∏—É—Å–∞
    const rows = 3;
    for (let r=1; r<=rows; r++){
      const rr = outerR*(0.42 + r*0.12);
      const mid = (a0+a1)/2;
      ctx.save();
      ctx.rotate(mid);
      ctx.translate(rr, 0);
      ctx.rotate(Math.PI/2);
      ctx.globalAlpha = 0.35;
      ctx.fillStyle = "rgba(255,255,255,0.85)";
      ctx.font = "800 34px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      // —Å–∏–º–≤–æ–ª –ø–æ—Ö–æ–∂–∏–π –Ω–∞ ‚Äú–∫–∞–ø–ª—é/—Å–µ—Ä–¥—Ü–µ‚Äù
      ctx.fillText("‚ùÑÔ∏é", 0, 0);
      ctx.restore();
    }
    ctx.globalAlpha = 1;
  }

  function drawBanner(sec){
    // –ë–∞–Ω–Ω–µ—Ä –≤ —Å—Ç–∏–ª–µ ‚Äú–ª–µ–Ω—Ç—ã‚Äù –≤–æ–∑–ª–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫—Ä–∞—è
    // –°–¥–µ–ª–∞–µ–º –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —Å –∑–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –∏ ‚Äú–≤—ã—Ä–µ–∑–æ–º‚Äù –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ.
    const bannerW = outerR*0.56;
    const bannerH = outerR*0.12;
    const bannerR = outerR*0.83;

    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(angle);

    // –ë–∞–Ω–Ω–µ—Ä –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ —Å–µ–∫—Ç–æ—Ä—É (–µ–≥–æ —Å–µ—Ä–µ–¥–∏–Ω–∞)
    // –ú—ã —É–∂–µ –Ω–∞ –ø–æ–≤–æ—Ä–æ—Ç–µ –∫–æ–ª–µ—Å–∞ angle, –Ω–æ –±–∞–Ω–Ω–µ—Ä —Ä–∏—Å—É–µ–º –≤–Ω—É—Ç—Ä–∏ –≤—Ä–∞—â–µ–Ω–∏—è:
    // –í—ã–∑—ã–≤–∞–µ–º –∏–∑ drawWheel –≤ –ø–æ–≤–µ—Ä–Ω—É—Ç—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö (–Ω–∏–∂–µ).
    ctx.restore();
  }

  function roundRect(x,y,w,h,r){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr,y);
    ctx.arcTo(x+w,y,x+w,y+h,rr);
    ctx.arcTo(x+w,y+h,x,y+h,rr);
    ctx.arcTo(x,y+h,x,y,rr);
    ctx.arcTo(x,y,x+w,y,rr);
    ctx.closePath();
  }

  function drawWheel(highlightIdx=null){
    ctx.clearRect(0,0,W,H);

    // –õ–µ–¥—è–Ω–æ–π —Ñ–æ–Ω –ø–æ–¥ –∫–æ–ª–µ—Å–æ–º
    ctx.save();
    const grd = ctx.createRadialGradient(cx,cy,innerR, cx,cy,outerR*1.05);
    grd.addColorStop(0,"rgba(255,255,255,0.90)");
    grd.addColorStop(0.55,"rgba(220,238,255,0.95)");
    grd.addColorStop(1,"rgba(170,210,245,0.95)");
    ctx.fillStyle = grd;
    ctx.beginPath();
    ctx.arc(cx,cy,outerR*1.03,0,Math.PI*2);
    ctx.fill();
    ctx.restore();

    // –¢–µ–º–Ω—ã–π –æ–±–æ–¥ –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ
    ctx.save();
    const rimGrad = ctx.createRadialGradient(cx,cy,outerR*0.93, cx,cy,outerR*1.03);
    rimGrad.addColorStop(0, "rgba(21,32,51,0.95)");
    rimGrad.addColorStop(1, "rgba(7,10,18,0.95)");
    ctx.strokeStyle = rimGrad;
    ctx.lineWidth = outerR*0.10;
    ctx.beginPath();
    ctx.arc(cx,cy,outerR*1.01,0,Math.PI*2);
    ctx.stroke();
    ctx.restore();

    // –°–µ–∫—Ç–æ—Ä–∞
    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate(angle);

    for (let i=0;i<N;i++){
      const a0 = i*step;
      const a1 = a0 + step;
      const sec = sectors[i];

      // —É–∑–∫–∏–µ –≥–æ–ª—É–±—ã–µ ‚Äú–ª—É—á–∏‚Äù
      const baseFill = (i%2===0) ? "rgba(120,185,235,0.70)" : "rgba(90,165,225,0.68)";
      const baseFill2 = (i%2===0) ? "rgba(240,250,255,0.65)" : "rgba(230,246,255,0.62)";

      const isHi = (highlightIdx===i);

      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0, outerR*0.90, a0, a1);
      ctx.closePath();

      if (sec.kind === "base"){
        // –≥—Ä–∞–¥–∏–µ–Ω—Ç ‚Äú–ª–µ–¥‚Äù
        const g = ctx.createRadialGradient(0,0,innerR,0,0,outerR*0.95);
        g.addColorStop(0, baseFill2);
        g.addColorStop(1, baseFill);
        ctx.fillStyle = g;
      } else {
        // —Å–ø–µ—Ü —Å–µ–∫—Ç–æ—Ä —á—É—Ç—å –≤—ã–¥–µ–ª–∏–º –º—è–≥–∫–æ
        const g = ctx.createRadialGradient(0,0,innerR,0,0,outerR*0.95);
        g.addColorStop(0, "rgba(255,255,255,0.85)");
        g.addColorStop(1, "rgba(120,185,235,0.55)");
        ctx.fillStyle = g;
      }
      ctx.fill();

      // –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ–¥ pointer (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è)
      if (isHi){
        ctx.fillStyle = "rgba(94,234,212,0.14)";
        ctx.fill();
      }

      // —Ç–æ–Ω–∫–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
      ctx.strokeStyle = "rgba(255,255,255,0.22)";
      ctx.lineWidth = 1.3;
      ctx.stroke();

      // –ø–∞—Ç—Ç–µ—Ä–Ω —Å–Ω–µ–∂–∏–Ω–∫–∏
      if (sec.kind === "base"){
        drawPatternInSlice(a0,a1);
      }
    }

    // –ë–∞–Ω–Ω–µ—Ä—ã –Ω–∞ —Å–ø–µ—Ü —Å–µ–∫—Ç–æ—Ä–∞—Ö (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ ‚Äî –ª–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º)
    for (let i=0;i<N;i++){
      const sec = sectors[i];
      if (sec.kind !== "special") continue;

      const mid = (i+0.5)*step;

      ctx.save();
      ctx.rotate(mid);

      const bannerW = outerR*0.58;
      const bannerH = outerR*0.12;
      const r = outerR*0.74;

      // —Å–∞–º –±–∞–Ω–Ω–µ—Ä
      ctx.translate(r, 0);
      ctx.rotate(Math.PI/2);

      // —Ç–µ–Ω—å
      ctx.save();
      ctx.translate(0, 4);
      ctx.globalAlpha = 0.35;
      ctx.fillStyle = "rgba(0,0,0,0.45)";
      roundRect(-bannerW/2, -bannerH/2, bannerW, bannerH, bannerH*0.45);
      ctx.fill();
      ctx.restore();

      // –∑–∞–ª–∏–≤–∫–∞
      ctx.fillStyle = sec.color;
      roundRect(-bannerW/2, -bannerH/2, bannerW, bannerH, bannerH*0.45);
      ctx.fill();

      // –º–∞–ª–µ–Ω—å–∫–∏–µ ‚Äú—É—à–∏‚Äù –ø–æ –±–æ–∫–∞–º (–∫–∞–∫ —Ö–≤–æ—Å—Ç–∏–∫–∏ –ª–µ–Ω—Ç–æ—á–∫–∏)
      ctx.fillStyle = "rgba(0,0,0,0.10)";
      ctx.beginPath();
      ctx.moveTo(-bannerW/2, -bannerH/2);
      ctx.lineTo(-bannerW/2 - bannerH*0.35, 0);
      ctx.lineTo(-bannerW/2, bannerH/2);
      ctx.closePath();
      ctx.fill();

      ctx.beginPath();
      ctx.moveTo(bannerW/2, -bannerH/2);
      ctx.lineTo(bannerW/2 + bannerH*0.35, 0);
      ctx.lineTo(bannerW/2, bannerH/2);
      ctx.closePath();
      ctx.fill();

      // —Ç–µ–∫—Å—Ç
      ctx.fillStyle = sec.text;
      ctx.font = `900 ${Math.floor(bannerH*0.48)}px system-ui, -apple-system, Segoe UI, Roboto, Arial`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.letterSpacing = "1px";
      ctx.fillText(sec.label, 0, 1);

      ctx.restore();
    }

    ctx.restore();

    // –¶–µ–Ω—Ç—Ä (—ç–º–±–ª–µ–º–∞ ICE FISHING)
    ctx.save();
    ctx.translate(cx,cy);

    // –≤–Ω–µ—à–Ω–∏–π –±–µ–ª—ã–π –∫—Ä—É–≥
    ctx.beginPath();
    ctx.arc(0,0, innerR*1.55, 0, Math.PI*2);
    ctx.fillStyle = "rgba(255,255,255,0.90)";
    ctx.fill();
    ctx.strokeStyle = "rgba(0,0,0,0.08)";
    ctx.lineWidth = 8;
    ctx.stroke();

    // –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫—Ä—É–≥
    ctx.beginPath();
    ctx.arc(0,0, innerR*1.05, 0, Math.PI*2);
    ctx.fillStyle = "rgba(240,250,255,0.95)";
    ctx.fill();
    ctx.strokeStyle = "rgba(0,0,0,0.10)";
    ctx.lineWidth = 6;
    ctx.stroke();

    // —Ç–µ–∫—Å—Ç ICE FISHING
    ctx.fillStyle = "rgba(11,18,32,0.90)";
    ctx.font = `900 ${Math.floor(innerR*0.38)}px system-ui, -apple-system, Segoe UI, Roboto, Arial`;
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText("ICE", 0, -innerR*0.18);
    ctx.fillText("FISHING", 0, innerR*0.20);

    ctx.restore();

    // –º–∞–ª–µ–Ω—å–∫–∏–µ ‚Äú–±–æ–ª—Ç–∏–∫–∏‚Äù –Ω–∞ –æ–±–æ–¥–µ (–æ—â—É—â–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∫–∏)
    ctx.save();
    ctx.translate(cx,cy);
    const bolts = 18;
    for (let i=0;i<bolts;i++){
      const a = (i/bolts)*Math.PI*2;
      const r = outerR*1.01;
      const x = Math.cos(a)*r;
      const y = Math.sin(a)*r;
      ctx.beginPath();
      ctx.arc(x,y, outerR*0.012, 0, Math.PI*2);
      ctx.fillStyle = "rgba(255,255,255,0.25)";
      ctx.fill();
    }
    ctx.restore();
  }

  // ====== SPIN (—Å –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ–º –∫–∞–∫ —É ‚Äúlive wheels‚Äù) ======
  function easeOutCubic(t){ return 1 - Math.pow(1-t, 3); }

  function pickWinnerIndex(){
    // –°–µ–π—á–∞—Å —Ä–∞–≤–Ω–æ–≤–µ—Ä–æ—è—Ç–Ω–æ —Å—Ä–µ–¥–∏ 53
    // –ü–æ–∑–∂–µ —Å–¥–µ–ª–∞–µ–º –≤–µ—Å–∞/—Ä–µ–¥–∫–æ—Å—Ç–∏ (–∫–∞–∫ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞)
    return Math.floor(Math.random()*N);
  }

  async function spin(){
    if (spinning) return;
    spinning = true;
    status.textContent = "SPINNING";
    spinBtn.disabled = true;

    const winner = pickWinnerIndex();

    // —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –æ–∫–∞–∑–∞–ª—Å—è –ø–æ–¥ —É–∫–∞–∑–∞—Ç–µ–ª–µ–º (–≤–≤–µ—Ä—Ö—É)
    const pointerWorld = -Math.PI/2;
    const winnerCenter = (winner + 0.5)*step;

    let target = pointerWorld - winnerCenter;

    // 7‚Äì10 –æ–±–æ—Ä–æ—Ç–æ–≤, –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–ª–≥–æ –∏ ‚Äú–ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É‚Äù)
    const extraTurns = 7 + Math.floor(Math.random()*4);
    // –º–∏–∫—Ä–æ–¥–∂–∏—Ç—Ç–µ—Ä –≤–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ç–æ—Ä–∞
    const jitter = (Math.random()-0.5)*step*0.25;

    target = target + jitter - extraTurns*Math.PI*2;

    const start = angle;
    const end = target;

    const duration = 5200 + Math.floor(Math.random()*900);
    const t0 = performance.now();

    await new Promise(resolve=>{
      function frame(now){
        const t = Math.min(1,(now-t0)/duration);
        const k = easeOutCubic(t);
        angle = start + (end-start)*k;

        const hi = indexAtPointer(angle);
        drawWheel(hi);

        if (t<1) requestAnimationFrame(frame);
        else resolve();
      }
      requestAnimationFrame(frame);
    });

    const finalIdx = indexAtPointer(angle);
    winText.textContent = winName(sectors[finalIdx]);
    winIdx.textContent = `${finalIdx+1} / ${N}`;
    status.textContent = "WIN!";

    // –ï—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å ‚Äî –æ—Ç–ø—Ä–∞–≤–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–æ—Ç–∞:
    // tg?.sendData?.(JSON.stringify({ idx: finalIdx, name: winName(sectors[finalIdx]) }));

    spinBtn.disabled = false;
    spinning = false;
  }

  function reset(){
    if (spinning) return;
    angle = 0;
    winText.textContent = "‚Äî";
    winIdx.textContent = "‚Äî";
    status.textContent = "READY";
    drawWheel(null);
  }

  spinBtn.addEventListener("click", spin);
  resetBtn.addEventListener("click", reset);

  drawWheel(null);
</script>
</body>
</html>
